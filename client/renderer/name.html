<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';" />
    <title>Name ändern</title>
    <style>
      :root {
        --accent: #afc6f3;
        --accentBorder: rgba(175, 198, 243, 0.9);
        --accentDim: rgba(175, 198, 243, 0.2);
        --bg: rgba(29, 33, 40, 0.6);
        --text: #e2e8f0;
        --muted: #9ca3af;
        --radius: 12px;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        backdrop-filter: blur(22px);
        -webkit-backdrop-filter: blur(22px);
        border-radius: var(--radius);
        border: 1px solid rgba(175, 198, 243, 0.15);
        overflow: hidden;
        /* Compositing hints to avoid ghosting on macOS */
        transform: translateZ(0);
        backface-visibility: hidden;
        will-change: transform, opacity;
        contain: paint;
        isolation: isolate;
      }
      .wrap { position: relative; z-index: 1; display: grid; gap: 16px; padding: 22px; transform: translateZ(0); backface-visibility: hidden; will-change: transform, opacity; contain: paint; }
      .backplate { position: fixed; inset: 0; z-index: 0; pointer-events: none; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background: rgba(29,33,40,0.35); border-radius: var(--radius); }
      .header { font-weight: 700; letter-spacing: .2px; color: var(--accent); text-shadow: 0 0 10px rgba(175,198,243,.3); }
      .label { font-size: 12px; color: var(--muted); }
      .field { background: rgba(29,33,40,0.45); border: 1px solid var(--accentDim); border-radius: var(--radius); padding: 14px; box-shadow: 0 0 0 1px rgba(175,198,243,0.12); transform: translateZ(0); backface-visibility: hidden; will-change: transform, opacity; contain: paint; }
      input[type="text"], input#name {
        width: 100%;
        background: transparent;
        border: none;
        outline: none;
        color: var(--text);
        font-size: 16px;
        -webkit-appearance: none;
        background-clip: padding-box;
        caret-color: var(--text);
      }
      ::placeholder { color: var(--muted); opacity: 0.9; }
      input::selection { background: rgba(175,198,243,0.25); }
      .field:hover { border-color: rgba(175,198,243,0.28); }
      .field:focus-within { outline: 2px solid var(--accent); outline-offset: 0; box-shadow: 0 0 0 1px var(--accentBorder); }
      .hint { color: var(--muted); font-size: 12px; }
      .actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 8px; }
      button { border: 0; border-radius: 12px; padding: 12px 18px; cursor: pointer; font-size: 15px; transform: translateZ(0); backface-visibility: hidden; will-change: transform, opacity; contain: paint; }
      .btn-secondary { background: rgba(175, 198, 243, 0.1); color: var(--accent); border: 1px solid var(--accentDim); transition: all .2s ease; }
      .btn-secondary:hover { background: rgba(175,198,243,0.2); transform: translateY(-1px) translateZ(0); }
      .btn-primary { background: rgba(175, 198, 243, 0.85); color: #1d2128; border: 1px solid var(--accentBorder); transition: all .2s ease; font-weight: 600; min-width: 120px; }
      .btn-primary:hover { background: rgba(175,198,243,0.95); transform: translateY(-1px) translateZ(0); }
      .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="header">Name ändern</div>
      <div class="label">Dein Anzeigename (2–24 Zeichen)</div>
      <div class="field">
        <input id="name" type="text" maxlength="24" placeholder="z. B. Ederino" />
      </div>
      <div class="hint">Wird bei Hamster/Toast als Absender angezeigt.</div>
      <div class="actions">
        <button
          class="btn-secondary"
          id="cancel">
          Abbrechen
        </button>
        <button
          class="btn-primary"
          id="save"
          disabled>
          Speichern
        </button>
      </div>
    </div>
    <script>
      const nameEl = document.getElementById("name");
      const saveBtn = document.getElementById("save");
      const cancelBtn = document.getElementById("cancel");
      function normalize(v) {
        return v.replace(/\s+/g, " ").trim();
      }
      function validate() {
        const v = normalize(nameEl.value);
        saveBtn.disabled = v.length < 2 || v.length > 24;
      }
      nameEl.addEventListener("input", validate);
      nameEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !saveBtn.disabled) {
          saveBtn.click();
        }
      });
      saveBtn.addEventListener("click", () => {
        window.namePrompt.submit({ name: normalize(nameEl.value) });
      });
      cancelBtn.addEventListener("click", () => window.namePrompt.cancel());
      // Prefill with current name from query (if provided)
      try {
        const u = new URL(window.location.href);
        const current = (u.searchParams.get("current") || "").trim();
        if (current) nameEl.value = current;
      } catch (_) {}
      validate();
      nameEl.focus();
    </script>
  </body>
</html>
