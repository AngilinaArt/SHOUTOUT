<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';" />
    <title>Shoutout – Translate</title>
    <style>
      :root {
        --bg: #1f2937;
        --panel: #374151;
        --muted: #9ca3af;
      }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: rgba(29,33,40,0.6);
        backdrop-filter: blur(25px);
        color: #afc6f3;
        display: flex; align-items: stretch;
        border-radius: 12px; overflow: hidden;
        border: 1px solid rgba(175,198,243,0.15);
      }
      .wrap { display: grid; grid-template-rows: auto 1fr; gap: 16px; width: 100%; padding: 20px; }
      .header { font-weight: 700; letter-spacing: 0.2px; }
      .controls { display:flex; gap:10px; align-items:center; }
      select, button { border-radius: 10px; border: 1px solid rgba(175,198,243,0.2); background: rgba(29,33,40,0.6); color:#e2e8f0; padding:8px 12px; }
      .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
      .bubble { position:relative; border-radius:12px; padding:14px; box-shadow: 0 6px 20px rgba(0,0,0,0.3), 0 0 0 1px rgba(175,198,243,0.15); backdrop-filter: blur(10px); background: rgba(29,33,40,0.85); }
      .bubble textarea { width:100%; height: calc(100vh - 240px); min-height: 280px; border:0; outline:0; resize: none; font-size:14px; color:#e2e8f0; background: transparent; }
      .bar { display:flex; gap:8px; justify-content:flex-end; }
      .btn { padding:10px 16px; border-radius:16px; font-weight:600; cursor:pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transition: all 0.2s ease; }
      .btn-primary { background: rgba(175,198,243,0.2); color:#fff; border:1px solid rgba(175,198,243,0.3); }
      .btn-ghost { background: rgba(255,255,255,0.1); color:#afc6f3; border:1px solid rgba(255,255,255,0.2); }
      .btn-primary:hover { background: rgba(175,198,243,0.3); border-color: rgba(175,198,243,0.4); box-shadow: 0 4px 12px rgba(175,198,243,0.2); }
      .btn-ghost:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
      .meta { font-size: 12px; color: var(--muted); }
      @media (max-width: 1024px) { .grid { grid-template-columns: 1fr; } .bubble textarea { height: 260px; } }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="header">Translate</div>
      <div class="controls">
        <label class="meta">Direction</label>
        <select id="direction">
          <option value="auto">Auto (DE↔EN)</option>
          <option value="de-en">DE → EN</option>
          <option value="en-de">EN → DE</option>
        </select>
        <div style="flex:1"></div>
        <button id="close" class="btn btn-ghost">CLOSE</button>
        <button id="swap" class="btn btn-ghost">Swap</button>
        <button id="clear" class="btn btn-ghost">Clear</button>
        <button id="copy" class="btn btn-ghost">Copy</button>
        <button id="go" class="btn btn-primary">Translate</button>
      </div>
      <div class="grid">
        <div class="bubble">
          <textarea id="src" placeholder="Paste text or emails here..."></textarea>
        </div>
        <div class="bubble">
          <textarea id="dst" placeholder="Translation appears here..." readonly></textarea>
        </div>
      </div>
    </div>
    <script>
      const $ = (id) => document.getElementById(id);
      const dirEl = $('direction');
      const srcEl = $('src');
      const dstEl = $('dst');
      const goEl = $('go');
      const copyEl = $('copy');
      const clearEl = $('clear');
      const swapEl = $('swap');
      const closeEl = $('close');

      async function doTranslate() {
        const text = srcEl.value || '';
        if (!text.trim()) { dstEl.value = ''; return; }
        dstEl.value = 'Translating...';
        const resp = await window.translator.translate({ text, direction: dirEl.value, formatMode: 'auto' });
        if (resp && resp.ok) {
          dstEl.value = resp.translated || '';
        } else {
          const reason = (resp && (resp.error || (resp.meta && resp.meta.reason))) || 'unavailable';
          dstEl.value = `[translation unavailable] (${reason})`;
        }
      }
      goEl.addEventListener('click', doTranslate);
      copyEl.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(dstEl.value || ''); } catch (_) {}
      });
      swapEl.addEventListener('click', () => {
        const a = srcEl.value; srcEl.value = dstEl.value; dstEl.value = a;
      });
      clearEl.addEventListener('click', () => { srcEl.value = ''; dstEl.value = ''; srcEl.focus(); });
      closeEl.addEventListener('click', () => { try { window.close(); } catch(_) { window.translator?.close?.(); } });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') { try { window.close(); } catch(_) { window.translator?.close?.(); } }
      });
      srcEl.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'enter') doTranslate();
      });
    </script>
  </body>
  </html>
